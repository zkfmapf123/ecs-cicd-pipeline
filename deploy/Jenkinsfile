pipeline {
    agent any

    stages {
        stage('Push ECR') {
            steps {
                dir("apiserver") {
                    script {
                        sh "docker build -t build-latest ."
                        sh "docker tag build-latest 182024812696.dkr.ecr.ap-northeast-2.amazonaws.com/todolist-repository:build-latest"
                        sh "aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin 182024812696.dkr.ecr.ap-northeast-2.amazonaws.com/todolist-repository"
                        sh "docker push 182024812696.dkr.ecr.ap-northeast-2.amazonaws.com/todolist-repository:build-latest"
                    }
                }
            }
        }

        stage("Deploy ECS") {
            steps {
                dir("apiserver/deploy") {
                    sh "ls"
                }
            }
        }
    }
}
